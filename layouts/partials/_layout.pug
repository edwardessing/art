doctype html
html(lang='en')
	head
		meta(charset='utf-8')
		meta(name='viewport' content='width=device-width, initial-scale=1')

		link(rel='shortcut', href='/img/art-fav.ico')
		link(rel='icon', href='/img/art-fav.ico')
		link(rel='stylesheet', href='/css/master.css')

		script(src='/js/jquery.min.js')
		script(src='/js/script.js')
		script(src='/js/lightbox.min.js')

		block title
			title Edward Essing Art

	body
		include ./_nav
		#container
			.container
				.header.row
					.col-xs-12(style='margin:50px auto;'): a(href='/') Edward Essing &mdash; Art
			block content
		block script

		script.
			$(function() {

				var imgStack;
				var loadTimeout;

				$(window).scroll(function() {
					 imgStack = null;
					 if (loadTimeout) clearTimeout(loadTimeout);

					 loadTimeout = setTimeout(function() {

						// get all links visible in the view port
						// should be an array or jQuery object
						var images = document.getElementsByTagName('img');
						var srcList = [];
						for(var i = 0; i < images.length; i++) {
						    srcList.push(images[i].src);
						}
						imgStack = srcList

						loadNextImage();
					 }, 200);                // 200 ms delay
				});

				function loadNextImage() {
					 if (imgStack && imgStack.length) {
						var nextLink = $(imgStack.pop());   // get next image element

						$('<img />').attr('src', nextLink.attr('href'))
						.appendTo(nextLink.parent())
						.load(function() {
							 loadNextImage();
						});

						// remove link from container (so we don't precess it twice)
						nextLink.remove();
					 }
				};

			});

			$('.img-thumb').each(function() {
				var path = $(this).attr("alt");
				var filename = path.replace(/^.*[\\\/]/, '');
				var caption = filename.replace(/\.[^/.]+$/, "")
				$(this).parent().prop('title', caption);
				if (caption != '') {
				var imgWidth = $(this).width();
				var imgHeight = $(this).height();
				var position = $(this).position();
				var positionTop = (position.top + imgHeight - 26)
				$("<span class='img-caption'>" + caption + "</span>").css({
					"display": "block",
					"width": "100%",
					"text-align": "center",
					"padding": "10px 0 40px"
				}).insertAfter(this);
				}

				$(this).attr('src', function(index, attr) {
					return attr.replace(/\.[^.]*$/, '_thumb$&');
				});
			});

			$('.gallery').magnificPopup({
				delegate: 'a.img',
				type: 'image',
				tLoading: 'Loading image %curr%...',
				mainClass: 'mfp-img-mobile',
				fixedBgPos: true,
				closeOnContentClick: true,
				gallery: {
					enabled: true,
					navigateByImgClick: false,
					preload: [0,1] // Will preload 0 - before current, and 1 after the current image
				},
				image: {
					tError: '<a href="%url%">The image #%curr%</a> could not be loaded.',
					titleSrc: function(item) {
						return item.el.attr('title');
					}
				}
			});